<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Retro Guessing Game</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/lucide@latest"></script> <!-- Lucide Icons -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@700&family=Press+Start+2P&display=swap" rel="stylesheet">

    <style>
      body {
        background-color: #0f172a; /* slate-900 */
        color: white;
        overflow: hidden;
        touch-action: manipulation;
        margin: 0;
      }
      /* Custom Font Classes */
      .font-8bit {
        font-family: 'Press Start 2P', cursive;
      }
      .font-noto {
        font-family: 'Noto Sans TC', sans-serif;
      }
      
      /* Card Flip Utilities */
      .perspective-1000 {
        perspective: 1000px;
      }
      .transform-style-3d {
        transform-style: preserve-3d;
      }
      .backface-hidden {
        backface-visibility: hidden;
      }
      .rotate-y-180 {
        transform: rotateY(180deg);
      }

      /* CRT Scanline Effect */
      .scanlines {
        background: linear-gradient(
          to bottom,
          rgba(255,255,255,0),
          rgba(255,255,255,0) 50%,
          rgba(0,0,0,0.2) 50%,
          rgba(0,0,0,0.2)
        );
        background-size: 100% 4px;
        position: fixed;
        pointer-events: none;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 50;
      }

      /* Landscape Warning */
      #orientation-warning {
        display: none;
      }

      @media screen and (orientation: portrait) and (min-width: 600px) {
        #orientation-warning {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0f172a;
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
      }
    </style>
</head>
<body>
    <div id="root"></div>
    <div class="scanlines"></div>
    
    <!-- Orientation Warning Layer -->
    <div id="orientation-warning">
        <div class="text-6xl mb-4">üì±‚û°Ô∏èüíª</div>
        <h1 class="text-3xl font-noto font-bold text-yellow-400">Ë´ãÊóãËΩâÊÇ®ÁöÑË£ùÁΩÆ</h1>
        <p class="text-xl font-noto text-white mt-4">ÁÇ∫‰∫ÜÊúÄ‰Ω≥È´îÈ©óÔºåË´ã‰ΩøÁî®Ê©´ÂºèÁÄèË¶Ω</p>
    </div>

    <script type="text/babel" data-presets="react,typescript">
        const { useState, useEffect, useRef, useCallback } = React;
        const { createRoot } = ReactDOM;

        // --- CONSTANTS & TYPES ---
        
        const View = {
          HOME: 'HOME',
          GAME_SELECT: 'GAME_SELECT',
          TOPIC_SELECT_A: 'TOPIC_SELECT_A',
          TOPIC_SELECT_B: 'TOPIC_SELECT_B',
          PREPARING: 'PREPARING',
          PRACTICE_INTRO: 'PRACTICE_INTRO',
          PRACTICE_PLAY: 'PRACTICE_PLAY',
          OFFICIAL_PRE_START: 'OFFICIAL_PRE_START',
          OFFICIAL_INTRO: 'OFFICIAL_INTRO',
          OFFICIAL_PLAY: 'OFFICIAL_PLAY',
          SCORE: 'SCORE',
          REVIEW: 'REVIEW',
          ADMIN: 'ADMIN'
        };

        const GameType = {
          A: 'A', // Silent Shout
          B: 'B'  // AI Image Guess
        };

        const TopicA = {
          DIET: 'È£≤È£ü',
          LIFE: 'ÁîüÊ¥ª',
          BRAND: 'ÂìÅÁâå'
        };

        const TopicB = {
          BRAND: 'ÂìÅÁâå',
          DIET: 'È£≤È£ü',
          MOVIE_CHAR: 'ÈõªÂΩ±&ËßíËâ≤'
        };

        const STORAGE_KEY_A = 'game_questions_a_v2';
        const STORAGE_KEY_B = 'game_questions_b_v2';
        const STORAGE_KEY_PRACTICE_B = 'game_practice_b_v2';
        const PLACEHOLDER_IMAGE = 'https://picsum.photos/600/600'; // Fallback if user doesn't upload

        // --- DATA INJECTION (USER PROVIDED) ---

        const DEFAULT_QUESTIONS_A = [
          // È£≤È£ü
          { id: 'a_d1', topic: TopicA.DIET, text: 'ÁèçÁè†Â•∂Ëå∂' },
          { id: 'a_d2', topic: TopicA.DIET, text: 'Êº¢Â†°' },
          { id: 'a_d3', topic: TopicA.DIET, text: 'Â∞èËÉñÈππÊ∞¥Èõû', subtext: '(ÊèêÁ§∫:Âú®ÊàëÂÄëÂÖ¨Âè∏ÈôÑËøëÂ∏∏ÂêÉÁöÑÂ∫ó)' },
          { id: 'a_d4', topic: TopicA.DIET, text: 'Â§©Â©¶ÁæÖ' },
          { id: 'a_d5', topic: TopicA.DIET, text: 'È∫ªËæ£Ëá≠Ë±ÜËÖê' },
          { id: 'a_d6', topic: TopicA.DIET, text: 'Ê≥°ËèúÈçã' },
          { id: 'a_d7', topic: TopicA.DIET, text: 'ÈêµÊùøÁáí' },
          { id: 'a_d8', topic: TopicA.DIET, text: 'ÈúúÊ∑áÊ∑ã' },
          { id: 'a_d9', topic: TopicA.DIET, text: 'ÂâùÁöÆËæ£Ê§í' },
          { id: 'a_d10', topic: TopicA.DIET, text: 'ÊãîÁµ≤Âú∞Áìú' },
          // ÁîüÊ¥ª
          { id: 'a_l1', topic: TopicA.LIFE, text: 'Ëù¶ÁöÆÂ∫óÂà∞Â∫ó' },
          { id: 'a_l2', topic: TopicA.LIFE, text: 'Ë±ÜÂ•∂' },
          { id: 'a_l3', topic: TopicA.LIFE, text: 'Á∞°ÊòéÈ¥ª', subtext: '(ÈòøÁ∞°)' },
          { id: 'a_l4', topic: TopicA.LIFE, text: '6/25', subtext: '(Ë´æË´æÁöÑÁîüÊó•)' },
          { id: 'a_l5', topic: TopicA.LIFE, text: 'Samsung buds 3 ËóçÁâôËÄ≥Ê©ü' },
          { id: 'a_l6', topic: TopicA.LIFE, text: '174', subtext: '(ÂÆ∂ÂÆ∂ÁöÑË∫´È´ò)' },
          { id: 'a_l7', topic: TopicA.LIFE, text: 'A7 È´îËÇ≤Â§ßÂ≠∏Á´ô', subtext: '(Ê©üÊç∑)' },
          { id: 'a_l8', topic: TopicA.LIFE, text: '0975603765', subtext: '(ËòáËè≤ÁöÑÈõªË©±)' },
          // ÂìÅÁâå
          { id: 'a_b1', topic: TopicA.BRAND, text: 'ÊòüÂ∑¥ÂÖã' },
          { id: 'a_b2', topic: TopicA.BRAND, text: 'NiKe' },
          { id: 'a_b3', topic: TopicA.BRAND, text: 'CHARLES & KEITH', subtext: '(Â∞èCK)' },
          { id: 'a_b4', topic: TopicA.BRAND, text: 'Dior' },
          { id: 'a_b5', topic: TopicA.BRAND, text: 'ÊÑõËø™ÈÅî' },
          { id: 'a_b6', topic: TopicA.BRAND, text: 'Tesla' },
          { id: 'a_b7', topic: TopicA.BRAND, text: 'ÁÑ°Âç∞ËâØÂìÅ', subtext: '(MUJI)' },
          { id: 'a_b8', topic: TopicA.BRAND, text: 'converse' },
          { id: 'a_b9', topic: TopicA.BRAND, text: 'ÂÆ∂Ê®ÇÁ¶è' },
          { id: 'a_b10', topic: TopicA.BRAND, text: 'IKEA' },
        ].map((q, i) => ({ ...q, timestamp: i }));

        const DEFAULT_QUESTIONS_B = [
            // ÂìÅÁâå
            { id: 'b_br1', topic: TopicB.BRAND, answer: 'Â•ΩÂ∏ÇÂ§ö', hint1: 'Êµ∑Â§ñÂìÅÁâå', hint2: 'ÈáèË≤©Â∫ó', imageBase64: '' },
            { id: 'b_br2', topic: TopicB.BRAND, answer: 'ÂÑ™Ë°£Â∫´(uniqlo)', hint1: 'Êó•Á≥ª', hint2: 'Ë®±ÂÖâÊº¢', imageBase64: '' },
            { id: 'b_br3', topic: TopicB.BRAND, answer: 'ÊùúËïæÊñØ', hint1: 'ÁîüÊ¥ªÁî®ÂìÅ', hint2: '‰∏ÄÂÄã‰∫∫ÁøíÊÖ£Ë≥ºË≤∑È†ªÁéá‰∏çÂêå', imageBase64: '' },
            { id: 'b_br4', topic: TopicB.BRAND, answer: 'ÊÑõÈ¶¨‰ªï', hint1: 'ÂúãÈöõÂìÅÁâå', hint2: 'Á≤æÂìÅ', imageBase64: '' },
            { id: 'b_br5', topic: TopicB.BRAND, answer: 'Ëê¨ÂØ∂Èæç', hint1: 'ÂúãÈöõÂìÅÁâå', hint2: 'logoÊúâÂÖ≠ËäíÊòü', imageBase64: '' },
            { id: 'b_br6', topic: TopicB.BRAND, answer: '‰∏âÂÆÖ‰∏ÄÁîü', hint1: 'Êó•Á≥ª', hint2: 'ÂâµËæ¶‰∫∫ÈÅé‰∏ñ', imageBase64: '' },
            { id: 'b_br7', topic: TopicB.BRAND, answer: 'ÁâõÈ†≠Áâå', hint1: 'Âè∞ÁÅ£', hint2: 'Â™ΩÂ™ΩÁöÑÊÑõ', imageBase64: '' },
            // È£≤È£ü
            { id: 'b_d1', topic: TopicB.DIET, answer: '‰∫îÂçÅÂµê', hint1: 'È£≤Êñô', hint2: 'ÊúâÊóèË≠ú', imageBase64: '' },
            { id: 'b_d2', topic: TopicB.DIET, answer: '‰∫îÊ°êËôü', hint1: 'È£≤Êñô', hint2: 'ÈÄöÂåñÂ§úÂ∏ÇÊúâ', imageBase64: '' },
            { id: 'b_d3', topic: TopicB.DIET, answer: 'ÈºéÊ≥∞Ë±ê', hint1: 'Âè∞ÁÅ£Áü•ÂêçÂìÅÁâå', hint2: 'ËßÄÂÖâÂÆ¢Â§ßÊéíÈï∑Èæç', imageBase64: '' },
            { id: 'b_d4', topic: TopicB.DIET, answer: 'Êµ™Âë≥‰ªô', hint1: 'Èõ∂È£ü', hint2: 'ÁÑ°Ê≥ïË¢´Âèñ‰ª£ÁöÑÂë≥ÈÅì', imageBase64: '' },
            { id: 'b_d5', topic: TopicB.DIET, answer: 'È¨çÈ¨öÂºµ', hint1: 'Âè∞ÁÅ£Âú®Âú∞ÂìÅÁâå', hint2: 'Â∞èÂêÉÂ∫ó', imageBase64: '' },
            { id: 'b_d6', topic: TopicB.DIET, answer: 'ËàíË∑ë', hint1: 'ÂúãÈöõÈ£≤ÂìÅ', hint2: 'Âà∞ËôïÈÉΩÊúâ', imageBase64: '' },
            // ÈõªÂΩ±&ËßíËâ≤
            { id: 'b_m1', topic: TopicB.MOVIE_CHAR, answer: 'ÂøÉÈùàÊçïÊâã', hint1: 'ÈõªÂΩ±', hint2: 'Ê∏ÖÊΩîÂ∑•ÁöÑÊïÖ‰∫ã', imageBase64: '' },
            { id: 'b_m2', topic: TopicB.MOVIE_CHAR, answer: 'Lalaland', hint1: 'ÈõªÂΩ±(ÁåúÈ°åÂèØ‰ª•ÂòóË©¶Áî®Âè∞Ë™ûÂñÆÂ≠ó)', hint2: 'Áï´Èù¢Ë∑üÊµ∑Â†±Áõ∏‰ºº', imageBase64: '' },
            { id: 'b_m3', topic: TopicB.MOVIE_CHAR, answer: '‰πùÂìÅËäùÈ∫ªÂÆò', hint1: 'Á∂ìÂÖ∏ÈõªÂΩ±', hint2: 'ËèØË™ûÂúà', imageBase64: '' },
            { id: 'b_m4', topic: TopicB.MOVIE_CHAR, answer: 'ËøΩÊÆ∫ÊØîÁàæ', hint1: 'Âæ©‰ªáÁöÑÊïÖ‰∫ã', hint2: 'Uma Thurman', imageBase64: '' },
            { id: 'b_m5', topic: TopicB.MOVIE_CHAR, answer: 'ÊÄ™Â•áÁâ©Ë™û', hint1: 'ÂΩ±ÈõÜ', hint2: '‰∏ªËßíÂêçÂ≠óË∑üÊï∏Â≠óÊúâÈóú', imageBase64: '' },
            { id: 'b_m6', topic: TopicB.MOVIE_CHAR, answer: 'ÁöÆÂÖãÊïè', hint1: 'Êó•Á≥ªËßíËâ≤', hint2: 'Êúâ‰∏ÉÁ®ÆÈ°èËâ≤', imageBase64: '' },
            { id: 'b_m7', topic: TopicB.MOVIE_CHAR, answer: 'Â≠îÂäâ', hint1: 'Â§ßÂèî', hint2: 'ÈüìÂúãÊºîÂì°', imageBase64: '' },
            { id: 'b_m8', topic: TopicB.MOVIE_CHAR, answer: 'ÈáëÂüéÊ≠¶', hint1: 'Âè∞ÁÅ£‰∫∫', hint2: 'Áü•ÂêçÁî∑Á•û', imageBase64: '' },
        ];

        const DEFAULT_PRACTICE_B = {
            imageBase64: '', // Empty initially
            answer: 'È≠îÊàí',
            hint1: 'ÈõªÂΩ±',
            hint2: 'Âü∑Âøµ'
        };

        // --- ICONS (Lucide Wrapper) ---
        const Icon = ({ name, size = 24, className }) => {
          useEffect(() => {
            if (window.lucide) {
                window.lucide.createIcons();
            }
          }, [name]);
          return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        const XIcon = (props) => <Icon name="x" {...props} />;
        const HomeIcon = (props) => <Icon name="home" {...props} />;
        const TrashIcon = (props) => <Icon name="trash-2" {...props} />;
        const EyeIcon = (props) => <Icon name="eye" {...props} />;
        const SaveIcon = (props) => <Icon name="save" {...props} />;
        const UploadIcon = (props) => <Icon name="upload" {...props} />;
        const DownloadIcon = (props) => <Icon name="download" {...props} />;
        const ImagePlusIcon = (props) => <Icon name="image-plus" {...props} />;

        // --- HOOKS ---

        const useLongPress = ({ onLongPress, ms = 500 }) => {
          const timerRef = useRef(null);

          const start = useCallback(() => {
            timerRef.current = setTimeout(() => {
              onLongPress();
            }, ms);
          }, [onLongPress, ms]);

          const stop = useCallback(() => {
            if (timerRef.current) {
              clearTimeout(timerRef.current);
              timerRef.current = null;
            }
          }, []);

          return {
            onMouseDown: start,
            onMouseUp: stop,
            onMouseLeave: stop,
            onTouchStart: start,
            onTouchEnd: stop,
          };
        };

        const useDoubleTap = ({ onDoubleTap, onSingleTap, delay = 300 }) => {
          const lastTapRef = useRef(0);
          const timerRef = useRef(null);

          const handleTap = useCallback(() => {
            const now = Date.now();
            if (now - lastTapRef.current < delay) {
              if (timerRef.current) clearTimeout(timerRef.current);
              onDoubleTap();
              lastTapRef.current = 0;
            } else {
              lastTapRef.current = now;
              if (onSingleTap) {
                timerRef.current = setTimeout(() => {
                  onSingleTap();
                  lastTapRef.current = 0;
                }, delay);
              }
            }
          }, [onDoubleTap, onSingleTap, delay]);

          return {
            onClick: handleTap,
          };
        };

        // --- COMPONENTS ---

        const TopRightHomeButton = ({ onClick }) => (
            <button 
                onClick={(e) => { e.stopPropagation(); onClick(); }} 
                className="absolute top-4 right-4 p-3 bg-slate-800 rounded-full border-2 border-gray-400 hover:border-white hover:bg-slate-700 text-white z-50 transition-all shadow-lg"
                aria-label="Back to Home"
            >
                <HomeIcon size={24} />
            </button>
        );

        const Card = ({ isFlipped, frontContent, backContent, onClick, className = '' }) => {
          return (
            <div 
              className={`relative w-64 h-80 perspective-1000 cursor-pointer ${className}`}
              onClick={onClick}
            >
              <div 
                className={`w-full h-full relative transform-style-3d transition-transform duration-700 ${isFlipped ? 'rotate-y-180' : ''}`}
              >
                {/* Front (Cover) */}
                <div className="absolute w-full h-full backface-hidden bg-slate-800 border-4 border-indigo-500 rounded-xl flex items-center justify-center shadow-[0_0_20px_rgba(99,102,241,0.5)]">
                   <div className="text-6xl animate-pulse">?</div>
                </div>

                {/* Back (Revealed) */}
                <div className="absolute w-full h-full backface-hidden rotate-y-180 bg-indigo-900 border-4 border-pink-500 rounded-xl flex items-center justify-center shadow-[0_0_20px_rgba(236,72,153,0.5)]">
                  <div className="text-3xl font-noto font-bold text-center p-4">
                    {backContent}
                  </div>
                </div>
              </div>
            </div>
          );
        };

        const CountdownOverlay = ({ onComplete }) => {
          const [count, setCount] = useState(3);

          useEffect(() => {
            if (count > 0) {
              const timer = setTimeout(() => setCount(count - 1), 1000);
              return () => clearTimeout(timer);
            } else {
              onComplete();
            }
          }, [count, onComplete]);

          if (count === 0) return null;

          return (
            <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/90 backdrop-blur-sm">
              <div className="text-9xl font-8bit text-yellow-400 animate-bounce">
                {count}
              </div>
            </div>
          );
        };

        // --- MAIN APP ---

        const App = () => {
          // --- STATE ---
          const [view, setView] = useState(View.HOME);
          const [selectedGame, setSelectedGame] = useState(null);
          const [selectedTopicA, setSelectedTopicA] = useState(null);
          const [selectedTopicB, setSelectedTopicB] = useState(null);
          
          const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
          const [practiceTimeLeft, setPracticeTimeLeft] = useState(60);
          const [gameTimeLeft, setGameTimeLeft] = useState(0); 
          const [stats, setStats] = useState({ correctCount: 0, passCount: 0, startTime: 0, endTime: 0 });
          
          const [hintStage, setHintStage] = useState(0); 
          const [preparingText, setPreparingText] = useState("Preparing");

          const [questionsA, setQuestionsA] = useState([]);
          const [questionsB, setQuestionsB] = useState([]);
          const [practiceB, setPracticeB] = useState(DEFAULT_PRACTICE_B);

          const [playQueue, setPlayQueue] = useState([]);
          const lastActionRef = useRef(0); // For Cooldown to prevent double skips

          // Admin State
          const [newQuestionAText, setNewQuestionAText] = useState('');
          const [newQuestionASubtext, setNewQuestionASubtext] = useState('');
          
          // Admin B - New Flow State
          const [newQuestionBTopic, setNewQuestionBTopic] = useState(TopicB.BRAND);
          const [newQuestionBAnswer, setNewQuestionBAnswer] = useState('');
          const [newQuestionBHint1, setNewQuestionBHint1] = useState('');
          const [newQuestionBHint2, setNewQuestionBHint2] = useState('');
          
          // Admin B - Editing/Image Upload State
          const [editingQuestionBId, setEditingQuestionBId] = useState(null); // Which question is being edited for image

          // Admin Practice B State
          const [editPracticeB, setEditPracticeB] = useState(DEFAULT_PRACTICE_B);

          const timerRef = useRef(null);

          // --- INITIALIZATION ---
          useEffect(() => {
            const storedA = localStorage.getItem(STORAGE_KEY_A);
            const storedB = localStorage.getItem(STORAGE_KEY_B);
            const storedPracticeB = localStorage.getItem(STORAGE_KEY_PRACTICE_B);

            // Use hardcoded defaults if storage is empty
            setQuestionsA(storedA ? JSON.parse(storedA) : DEFAULT_QUESTIONS_A);
            setQuestionsB(storedB ? JSON.parse(storedB) : DEFAULT_QUESTIONS_B);
            
            if (storedPracticeB) {
                const parsedPB = JSON.parse(storedPracticeB);
                setPracticeB(parsedPB);
                setEditPracticeB(parsedPB);
            }
          }, []);

          // --- VIEW: PREPARING ANIMATION ---
          useEffect(() => {
            if (view === View.PREPARING) {
              const interval = setInterval(() => {
                setPreparingText(prev => prev.length > 12 ? "Preparing" : prev + ".");
              }, 500);
              return () => clearInterval(interval);
            }
          }, [view]);

          // --- HELPERS ---
          const resetGame = () => {
            setStats({ correctCount: 0, passCount: 0, startTime: 0, endTime: 0 });
            setCurrentQuestionIndex(0);
            setHintStage(0);
            setPlayQueue([]);
            setPracticeTimeLeft(60);
            if (timerRef.current) clearInterval(timerRef.current);
          };

          const goHome = () => {
            resetGame();
            setView(View.HOME);
          };

          const startTimer = (initialTime, setter, onFinish) => {
            setter(initialTime);
            if (timerRef.current) clearInterval(timerRef.current);
            timerRef.current = setInterval(() => {
              setter(prev => {
                if (prev <= 1) {
                  if (timerRef.current) clearInterval(timerRef.current);
                  onFinish();
                  return 0;
                }
                return prev - 1;
              });
            }, 1000);
          };

          const endGame = () => {
            if (timerRef.current) clearInterval(timerRef.current);
            setStats(prev => ({ ...prev, endTime: Date.now() }));
            setView(View.SCORE);
          };

          const handleNextQuestion = (isCorrect) => {
            const now = Date.now();
            // COOLDOWN FIX: Prevent jumping two questions
            if (now - lastActionRef.current < 500) return;
            lastActionRef.current = now;

            setStats(prev => ({
              ...prev,
              correctCount: isCorrect ? prev.correctCount + 1 : prev.correctCount,
              passCount: !isCorrect ? prev.passCount + 1 : prev.passCount
            }));

            // Reset hints immediately for the next question
            setHintStage(0);
            
            if (currentQuestionIndex < playQueue.length - 1) {
              setCurrentQuestionIndex(prev => prev + 1);
            } else {
               endGame();
            }
          };

          const handleHintAdvance = () => {
              const now = Date.now();
              // Small debounce for hint tapping
              if (now - lastActionRef.current < 200) return;
              lastActionRef.current = now;
              
              setHintStage(prev => Math.min(prev + 1, 2));
          };

          // --- GESTURES ---
          const homeLongPress = useLongPress({
            onLongPress: () => setView(View.ADMIN),
            ms: 3000
          });

          const topicDoubleTap = useDoubleTap({
            onDoubleTap: () => {
              if (selectedGame === GameType.A && selectedTopicA) {
                setView(View.PREPARING);
              } else if (selectedGame === GameType.B && selectedTopicB) {
                setView(View.PRACTICE_INTRO); 
              }
            }
          });

          const preparingDoubleTap = useDoubleTap({
            onDoubleTap: () => setView(View.PRACTICE_INTRO)
          });

          const gameControlHandlers = useDoubleTap({
            onDoubleTap: () => {
               if (view === View.PRACTICE_PLAY) {
                 if (timerRef.current) clearInterval(timerRef.current);
                 setView(View.OFFICIAL_PRE_START);
                 return; 
               }

               if (view === View.OFFICIAL_PLAY) {
                 if (gameTimeLeft === 0) {
                   endGame();
                 } else {
                   handleNextQuestion(true);
                 }
               }
            },
            onSingleTap: () => {
              if ((view === View.PRACTICE_PLAY || view === View.OFFICIAL_PLAY) && selectedGame === GameType.B) {
                handleHintAdvance();
              }
            }
          });

          const gameLongPress = useLongPress({
            onLongPress: () => {
              if (view === View.OFFICIAL_PLAY && gameTimeLeft > 0) {
                handleNextQuestion(false);
              }
            },
            ms: 1000
          });

          const handleTopicSelectA = (topic) => {
            setSelectedTopicA(topic);
            const queue = questionsA
              .filter(q => q.topic === topic)
              .sort((a, b) => a.timestamp - b.timestamp);
            setPlayQueue(queue);
          };

          const handleTopicSelectB = (topic) => {
            setSelectedTopicB(topic);
            const queue = questionsB
              .filter(q => q.topic === topic)
              .sort(() => Math.random() - 0.5);
            setPlayQueue(queue);
          };

          const handleImageUploadForId = (e, id, isPractice = false) => {
            const file = e.target.files?.[0];
            if (file) {
              const reader = new FileReader();
              reader.onloadend = () => {
                if (isPractice) {
                    setEditPracticeB(prev => ({ ...prev, imageBase64: reader.result }));
                } else {
                    const updated = questionsB.map(q => 
                        q.id === id ? { ...q, imageBase64: reader.result } : q
                    );
                    setQuestionsB(updated);
                    localStorage.setItem(STORAGE_KEY_B, JSON.stringify(updated));
                }
              };
              reader.readAsDataURL(file);
            }
          };

          // --- DATA EXPORT / IMPORT ---
          const exportData = () => {
             const data = {
                 questionsA,
                 questionsB,
                 practiceB: editPracticeB,
                 timestamp: Date.now()
             };
             const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
             const url = URL.createObjectURL(blob);
             const a = document.createElement('a');
             a.href = url;
             a.download = 'retro_guessing_game_data.json';
             a.click();
             URL.revokeObjectURL(url);
          };

          const importData = (e) => {
             const file = e.target.files?.[0];
             if(!file) return;
             
             const reader = new FileReader();
             reader.onload = (event) => {
                 try {
                     const data = JSON.parse(event.target.result);
                     if(data.questionsA) {
                         setQuestionsA(data.questionsA);
                         localStorage.setItem(STORAGE_KEY_A, JSON.stringify(data.questionsA));
                     }
                     if(data.questionsB) {
                         setQuestionsB(data.questionsB);
                         localStorage.setItem(STORAGE_KEY_B, JSON.stringify(data.questionsB));
                     }
                     if(data.practiceB) {
                         setEditPracticeB(data.practiceB);
                         setPracticeB(data.practiceB);
                         localStorage.setItem(STORAGE_KEY_PRACTICE_B, JSON.stringify(data.practiceB));
                     }
                     alert("ÂåØÂÖ•ÊàêÂäüÔºÅË≥áÊñôÂ∑≤Êõ¥Êñ∞ (Import Successful!)");
                 } catch (err) {
                     alert("ÂåØÂÖ•Â§±ÊïóÔºöÊ™îÊ°àÊ†ºÂºèÈåØË™§ (Import Failed)");
                 }
             };
             reader.readAsText(file);
          };

          const addQuestionA = () => {
            if (!newQuestionAText || !selectedTopicA) return;
            const newQ = {
              id: Date.now().toString(),
              topic: selectedTopicA,
              text: newQuestionAText,
              subtext: newQuestionASubtext,
              timestamp: Date.now()
            };
            const updated = [...questionsA, newQ];
            setQuestionsA(updated);
            localStorage.setItem(STORAGE_KEY_A, JSON.stringify(updated));
            setNewQuestionAText('');
            setNewQuestionASubtext('');
          };

          const deleteQuestionA = (id) => {
            const updated = questionsA.filter(q => q.id !== id);
            setQuestionsA(updated);
            localStorage.setItem(STORAGE_KEY_A, JSON.stringify(updated));
          };

          // NEW Workflow: Add Text First, Image Later
          const addQuestionBText = () => {
            if (!newQuestionBAnswer || !newQuestionBHint1 || !newQuestionBHint2) return;
            const newQ = {
              id: Date.now().toString(),
              topic: newQuestionBTopic,
              imageBase64: '', // Empty initially
              answer: newQuestionBAnswer,
              hint1: newQuestionBHint1,
              hint2: newQuestionBHint2
            };
            const updated = [...questionsB, newQ];
            setQuestionsB(updated);
            localStorage.setItem(STORAGE_KEY_B, JSON.stringify(updated));
            // Reset fields
            setNewQuestionBAnswer('');
            setNewQuestionBHint1('');
            setNewQuestionBHint2('');
          };

          const deleteQuestionB = (id) => {
            const updated = questionsB.filter(q => q.id !== id);
            setQuestionsB(updated);
            localStorage.setItem(STORAGE_KEY_B, JSON.stringify(updated));
            if(editingQuestionBId === id) setEditingQuestionBId(null);
          };
          
          const savePracticeB = () => {
             setPracticeB(editPracticeB);
             localStorage.setItem(STORAGE_KEY_PRACTICE_B, JSON.stringify(editPracticeB));
             alert('Practice Question Saved!');
          };

          // --- RENDER ---

          if (view === View.HOME) {
            return (
              <div className="h-screen w-screen flex flex-col items-center justify-center bg-slate-900 relative">
                <h1 className="text-4xl md:text-6xl font-8bit text-green-400 mb-12 animate-pulse text-center leading-normal">
                  Retro<br/>Guessing
                </h1>
                <button
                  {...homeLongPress}
                  onClick={() => setView(View.GAME_SELECT)}
                  className="font-8bit text-2xl md:text-4xl text-white hover:text-yellow-400 transition-colors border-4 border-white p-6 rounded-none active:bg-white active:text-black select-none z-10"
                >
                  Game start
                </button>
              </div>
            );
          }

          if (view === View.GAME_SELECT) {
            return (
              <div className="h-screen w-screen flex flex-col md:flex-row items-center justify-center gap-12 bg-slate-900 p-8">
                <TopRightHomeButton onClick={goHome} />
                <div 
                  onClick={() => { setSelectedGame(GameType.A); setView(View.TOPIC_SELECT_A); }}
                  className="bg-slate-800 p-8 rounded-2xl border-4 border-cyan-500 hover:scale-105 transition-transform cursor-pointer text-center z-10"
                >
                  <div className="text-6xl mb-4">üíÄüíÄüíÄ</div>
                  <div className="text-4xl">üôâüéßüó£Ô∏èüôç‚Äç‚ôÄÔ∏è</div>
                </div>
                <div 
                  onClick={() => { setSelectedGame(GameType.B); setView(View.TOPIC_SELECT_B); }}
                  className="bg-slate-800 p-8 rounded-2xl border-4 border-purple-500 hover:scale-105 transition-transform cursor-pointer text-center z-10"
                >
                  <div className="text-6xl mb-4">üëªüëªüëª</div>
                  <div className="text-4xl">üëÄüñºÔ∏èü§îüôã‚Äç‚ôÄÔ∏è</div>
                </div>
              </div>
            );
          }

          if (view === View.TOPIC_SELECT_A || view === View.TOPIC_SELECT_B) {
            const isA = view === View.TOPIC_SELECT_A;
            const topics = isA ? Object.values(TopicA) : Object.values(TopicB);
            const selected = isA ? selectedTopicA : selectedTopicB;

            return (
              <div 
                className="h-screen w-screen flex flex-col items-center justify-center gap-8 bg-slate-900 p-4"
                {...topicDoubleTap} 
              >
                <TopRightHomeButton onClick={goHome} />
                <h2 className="text-3xl font-noto text-white mb-8">
                  {selected ? 'Double Tap to Confirm' : 'Select a Topic'}
                </h2>
                <div className="flex flex-wrap justify-center gap-6 z-10">
                  {topics.map((topic) => (
                    <Card
                      key={topic}
                      isFlipped={selected === topic}
                      frontContent={null}
                      backContent={topic}
                      onClick={() => isA ? handleTopicSelectA(topic) : handleTopicSelectB(topic)}
                      className={selected === topic ? 'ring-4 ring-yellow-400 rounded-xl scale-110' : ''}
                    />
                  ))}
                </div>
              </div>
            );
          }

          if (view === View.PREPARING) {
            return (
              <div 
                className="h-screen w-screen flex items-center justify-center bg-black"
                {...preparingDoubleTap}
              >
                <h1 className="text-5xl font-8bit text-green-500">{preparingText}</h1>
              </div>
            );
          }

          if (view === View.PRACTICE_INTRO) {
            return <CountdownOverlay onComplete={() => {
              setView(View.PRACTICE_PLAY);
              setHintStage(0); // Reset hints for practice
              setPracticeTimeLeft(60);
              startTimer(60, setPracticeTimeLeft, () => {});
            }} />;
          }

          if (view === View.PRACTICE_PLAY) {
            const isTimeUp = practiceTimeLeft === 0;

            return (
              <div 
                className="h-screen w-screen flex flex-col items-center justify-center bg-slate-900 relative"
                {...gameControlHandlers} 
              >
                <div className="absolute top-4 left-4 text-4xl font-8bit text-red-500 z-10">
                   {isTimeUp ? '0' : practiceTimeLeft}
                </div>

                <div className="w-full h-full flex items-center justify-center p-8 z-10">
                  {isTimeUp ? (
                     <div className="text-center">
                        <h1 className="text-6xl font-noto text-red-500 mb-8 animate-bounce">ÊôÇÈñìÁµÇ‰∫Ü</h1>
                        {selectedGame === GameType.B && (
                          <h2 className="text-4xl font-noto text-white">Ë¨éÂ∫ïÔºö{practiceB.answer}</h2>
                        )}
                     </div>
                  ) : (
                    <>
                      {selectedGame === GameType.A ? (
                        <div className="text-[12vw] font-noto text-white text-center leading-tight">
                          Âè∞ÂåóËΩâÈÅãÁ´ô
                        </div>
                      ) : (
                        <div className="relative w-full h-full flex items-center justify-center">
                           {practiceB.imageBase64 ? (
                               <img src={practiceB.imageBase64} alt="Practice" className="max-w-full max-h-full object-contain border-4 border-white" />
                           ) : (
                               <div className="text-4xl text-gray-500">No Image Uploaded</div>
                           )}
                           
                           {hintStage >= 1 && (
                             <div className="absolute bottom-10 left-10 bg-black/80 p-4 rounded text-2xl font-noto text-yellow-300">
                               Hint 1: {practiceB.hint1}
                             </div>
                           )}
                           {hintStage >= 2 && (
                             <div className="absolute bottom-10 right-10 bg-black/80 p-4 rounded text-2xl font-noto text-yellow-300">
                               Hint 2: {practiceB.hint2}
                             </div>
                           )}
                        </div>
                      )}
                    </>
                  )}
                </div>
                
                <div className="absolute top-4 right-4 text-gray-500 font-noto text-sm">
                   Practice Mode
                </div>
              </div>
            );
          }

          if (view === View.OFFICIAL_PRE_START) {
            return (
              <div 
                className="h-screen w-screen flex items-center justify-center bg-slate-900 cursor-pointer"
                onClick={() => setView(View.OFFICIAL_INTRO)}
              >
                <TopRightHomeButton onClick={goHome} />
                <div className="text-center animate-pulse">
                  <h1 className="text-6xl font-noto text-white mb-4">Ê≠£ÂºèÈñãÂßã</h1>
                  <p className="text-xl text-gray-400 font-8bit">CLICK TO START</p>
                </div>
              </div>
            );
          }

          if (view === View.OFFICIAL_INTRO) {
            return <CountdownOverlay onComplete={() => {
              // Ensure hints are reset BEFORE view switch
              setHintStage(0);
              setView(View.OFFICIAL_PLAY);
              const duration = selectedGame === GameType.A ? 180 : 300;
              setGameTimeLeft(duration);
              setStats(prev => ({ ...prev, startTime: Date.now() }));
              startTimer(duration, setGameTimeLeft, () => { /* Timer End */ });
            }} />;
          }

          if (view === View.OFFICIAL_PLAY) {
            const isTimeUp = gameTimeLeft === 0;
            const currentQ = playQueue[currentQuestionIndex];

            return (
              <div 
                className="h-screen w-screen bg-slate-900 relative select-none"
                {...gameControlHandlers} 
                {...gameLongPress}
              >
                <div className={`absolute top-4 left-4 text-4xl font-8bit z-10 ${gameTimeLeft < 10 ? 'text-red-600 animate-pulse' : 'text-green-500'}`}>
                   {Math.floor(gameTimeLeft / 60)}:{(gameTimeLeft % 60).toString().padStart(2, '0')}
                </div>

                <div className="w-full h-full flex items-center justify-center p-4 z-10">
                  {!currentQ ? (
                    <div className="text-4xl font-noto">No Questions Found</div>
                  ) : selectedGame === GameType.A ? (
                     <div className="flex flex-col items-center">
                        <div className="text-[15vw] font-noto text-white text-center leading-none break-words w-full">
                           {currentQ.text}
                        </div>
                        {currentQ.subtext && (
                            <div className="text-[4vw] font-noto text-gray-400 mt-4">{currentQ.subtext}</div>
                        )}
                     </div>
                  ) : (
                     <div className="relative w-full h-full flex items-center justify-center">
                        {currentQ.imageBase64 ? (
                           <img 
                             src={currentQ.imageBase64} 
                             alt="Guess" 
                             className="max-w-full max-h-full object-contain border-4 border-gray-700" 
                           />
                        ) : (
                           <div className="text-4xl text-gray-500 font-noto">
                               {currentQ.topic} <br/> (No Image - Ask Admin to Upload)
                           </div>
                        )}
                        
                         {hintStage >= 1 && (
                             <div className="absolute bottom-12 left-12 bg-indigo-900/90 p-6 rounded-xl border-2 border-yellow-400">
                               <p className="text-yellow-400 font-noto text-3xl">üí° {currentQ.hint1}</p>
                             </div>
                           )}
                           {hintStage >= 2 && (
                             <div className="absolute bottom-12 right-12 bg-indigo-900/90 p-6 rounded-xl border-2 border-yellow-400">
                               <p className="text-yellow-400 font-noto text-3xl">üí° {currentQ.hint2}</p>
                             </div>
                           )}
                     </div>
                  )}
                </div>

                {isTimeUp && (
                  <div className="absolute inset-0 bg-black/80 flex items-center justify-center z-40">
                     <h1 className="text-6xl font-8bit text-red-500 animate-bounce">TIME UP</h1>
                     <p className="absolute bottom-10 text-white font-noto animate-pulse">Double Tap to Finish</p>
                  </div>
                )}
              </div>
            );
          }

          if (view === View.SCORE) {
            const totalTimeSeconds = Math.floor((stats.endTime - stats.startTime) / 1000);
            const displayMinutes = Math.floor(totalTimeSeconds / 60);
            const displaySeconds = totalTimeSeconds % 60;

            return (
              <div className="h-screen w-screen flex flex-col items-center justify-center bg-slate-900 gap-8">
                <TopRightHomeButton onClick={goHome} />
                
                <h1 className="text-6xl font-8bit text-yellow-400 mb-8">RESULTS</h1>
                
                <div className="bg-slate-800 p-12 rounded-3xl border-4 border-white w-3/4 max-w-2xl z-10 flex flex-col gap-6">
                   <div className="flex justify-between items-center border-b-2 border-gray-600 pb-4">
                      <span className="text-3xl font-noto text-gray-400">Total Time</span>
                      <span className="text-4xl font-8bit text-white">
                        {displayMinutes}ÂàÜ {displaySeconds}Áßí
                      </span>
                   </div>
                   <div className="flex justify-between items-center border-b-2 border-gray-600 pb-4">
                      <span className="text-3xl font-noto text-green-400">Correct</span>
                      <span className="text-4xl font-8bit text-green-400">{stats.correctCount}</span>
                   </div>
                   <div className="flex justify-between items-center">
                      <span className="text-3xl font-noto text-red-400">Passed</span>
                      <span className="text-4xl font-8bit text-red-400">{stats.passCount}</span>
                   </div>
                   
                   <button 
                      onClick={() => setView(View.REVIEW)}
                      className="mt-4 bg-yellow-600 hover:bg-yellow-500 text-white font-noto text-2xl py-3 rounded-lg flex items-center justify-center gap-2"
                   >
                     <EyeIcon /> ËßÄÁúãËß£Á≠î
                   </button>
                </div>
              </div>
            );
          }

          if (view === View.REVIEW) {
            return (
              <div className="min-h-screen w-full bg-slate-900 p-8 overflow-y-auto relative">
                <TopRightHomeButton onClick={goHome} />
                <h1 className="text-4xl font-8bit text-yellow-400 mb-8 text-center">ANSWER REVIEW</h1>
                
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                  {playQueue.map((q, idx) => (
                    <div key={idx} className="bg-slate-800 p-4 rounded-xl border-2 border-gray-600 flex flex-col items-center">
                       {selectedGame === GameType.A ? (
                         <div className="text-center py-4">
                             <div className="text-2xl font-noto text-white mb-2">{q.text}</div>
                             <div className="text-sm font-noto text-gray-400">{q.subtext}</div>
                         </div>
                       ) : (
                         <>
                           {q.imageBase64 ? (
                               <img src={q.imageBase64} className="h-48 object-contain mb-4 rounded border border-gray-500" />
                           ) : (
                               <div className="h-48 w-full flex items-center justify-center bg-gray-700 text-gray-400 mb-4 rounded">No Image</div>
                           )}
                           <div className="w-full bg-slate-900 p-3 rounded text-center">
                             <p className="text-green-400 font-noto text-xl font-bold">{q.answer || 'No Answer Set'}</p>
                           </div>
                         </>
                       )}
                       <div className="mt-2 text-gray-500 font-noto text-sm">Question {idx + 1}</div>
                    </div>
                  ))}
                  {playQueue.length === 0 && (
                    <div className="col-span-full text-center text-gray-500 text-xl font-noto">
                      No questions were played.
                    </div>
                  )}
                </div>
              </div>
            );
          }

          if (view === View.ADMIN) {
            return (
              <div className="min-h-screen w-full bg-slate-900 p-8 overflow-y-auto z-10 relative">
                <TopRightHomeButton onClick={goHome} />
                <div className="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                   <h1 className="text-4xl font-8bit text-blue-400">ADMIN PANEL</h1>
                   <div className="flex gap-4">
                       <label className="bg-yellow-600 hover:bg-yellow-500 text-white px-4 py-2 rounded font-bold flex items-center gap-2 cursor-pointer">
                           <UploadIcon size={20} /> IMPORT
                           <input type="file" onChange={importData} accept=".json" className="hidden" />
                       </label>
                       <button 
                         onClick={exportData} 
                         className="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded font-bold flex items-center gap-2"
                       >
                         <DownloadIcon size={20} /> EXPORT
                       </button>
                   </div>
                </div>

                {/* Edit Practice B Section */}
                <div className="bg-slate-800 p-6 rounded-xl border-2 border-green-500 mb-8">
                    <h2 className="text-2xl font-noto mb-4 text-green-400">Edit Practice Question B</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                             <input 
                                type="file" 
                                accept="image/*"
                                onChange={(e) => handleImageUploadForId(e, null, true)}
                                className="w-full mb-4 text-gray-400"
                            />
                            {editPracticeB.imageBase64 && <img src={editPracticeB.imageBase64} className="h-40 mb-4 object-contain border border-gray-600 rounded" />}
                        </div>
                        <div>
                             <input 
                                type="text" 
                                placeholder="Answer (Ëß£Á≠î)" 
                                value={editPracticeB.answer}
                                onChange={e => setEditPracticeB({...editPracticeB, answer: e.target.value})}
                                className="w-full p-3 bg-slate-900 border border-yellow-600 rounded mb-2 text-yellow-300"
                            />
                            <input 
                                type="text" 
                                placeholder="Hint 1" 
                                value={editPracticeB.hint1}
                                onChange={e => setEditPracticeB({...editPracticeB, hint1: e.target.value})}
                                className="w-full p-3 bg-slate-900 border border-gray-600 rounded mb-2"
                            />
                            <input 
                                type="text" 
                                placeholder="Hint 2" 
                                value={editPracticeB.hint2}
                                onChange={e => setEditPracticeB({...editPracticeB, hint2: e.target.value})}
                                className="w-full p-3 bg-slate-900 border border-gray-600 rounded mb-4"
                            />
                            <button onClick={savePracticeB} className="w-full bg-green-600 p-3 rounded font-bold hover:bg-green-500">
                                SAVE PRACTICE QUESTION
                            </button>
                        </div>
                    </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                  {/* Add A */}
                  <div className="bg-slate-800 p-6 rounded-xl border-2 border-cyan-500">
                    <h2 className="text-2xl font-noto mb-4 text-cyan-400">Add Question A (Silent)</h2>
                    <div className="flex gap-2 mb-4">
                      {Object.values(TopicA).map(t => (
                        <button 
                          key={t}
                          onClick={() => setSelectedTopicA(t)}
                          className={`px-4 py-2 rounded ${selectedTopicA === t ? 'bg-cyan-600' : 'bg-gray-700'}`}
                        >
                          {t}
                        </button>
                      ))}
                    </div>
                    <input 
                      type="text" 
                      placeholder="Question Text (e.g. ÁèçÁè†Â•∂Ëå∂)" 
                      value={newQuestionAText}
                      onChange={e => setNewQuestionAText(e.target.value)}
                      className="w-full p-3 bg-slate-900 border border-gray-600 rounded mb-2 text-xl"
                    />
                    <input 
                      type="text" 
                      placeholder="Subtext (e.g. ÊèêÁ§∫:ÂæàÂ•ΩÂñù)" 
                      value={newQuestionASubtext}
                      onChange={e => setNewQuestionASubtext(e.target.value)}
                      className="w-full p-3 bg-slate-900 border border-gray-600 rounded mb-4 text-sm text-gray-300"
                    />
                    <button onClick={addQuestionA} className="w-full bg-cyan-600 p-3 rounded font-bold hover:bg-cyan-500">
                      ADD QUESTION A
                    </button>
                  </div>

                  {/* Add B */}
                  <div className="bg-slate-800 p-6 rounded-xl border-2 border-purple-500">
                    <h2 className="text-2xl font-noto mb-4 text-purple-400">Add Question B (Data First)</h2>
                    <div className="flex gap-2 mb-4 flex-wrap">
                      {Object.values(TopicB).map(t => (
                        <button 
                          key={t}
                          onClick={() => setNewQuestionBTopic(t)}
                          className={`px-4 py-2 rounded ${newQuestionBTopic === t ? 'bg-purple-600' : 'bg-gray-700'}`}
                        >
                          {t}
                        </button>
                      ))}
                    </div>
                    
                    <input 
                      type="text" 
                      placeholder="Answer (Ëß£Á≠î)" 
                      value={newQuestionBAnswer}
                      onChange={e => setNewQuestionBAnswer(e.target.value)}
                      className="w-full p-3 bg-slate-900 border border-yellow-600 rounded mb-2 text-yellow-300 placeholder-gray-500"
                    />

                    <input 
                      type="text" 
                      placeholder="Hint 1" 
                      value={newQuestionBHint1}
                      onChange={e => setNewQuestionBHint1(e.target.value)}
                      className="w-full p-3 bg-slate-900 border border-gray-600 rounded mb-2"
                    />
                    <input 
                      type="text" 
                      placeholder="Hint 2" 
                      value={newQuestionBHint2}
                      onChange={e => setNewQuestionBHint2(e.target.value)}
                      className="w-full p-3 bg-slate-900 border border-gray-600 rounded mb-4"
                    />
                    <button onClick={addQuestionBText} className="w-full bg-purple-600 p-3 rounded font-bold hover:bg-purple-500 mb-4">
                      ADD DATA (Step 1)
                    </button>
                    <p className="text-sm text-gray-400 text-center">Step 2: Find the question in the list below and click to upload image.</p>
                  </div>
                </div>

                <div className="mt-8">
                  <h3 className="text-xl mb-4 text-cyan-400">Questions A List ({questionsA.length})</h3>
                  <div className="flex flex-wrap gap-2 mb-8 max-h-60 overflow-y-auto">
                    {questionsA.map(q => (
                      <div key={q.id} className="bg-gray-700 px-3 py-2 rounded flex items-center gap-2">
                        <span className="text-sm">[{q.topic}] {q.text} <span className="text-gray-400 text-xs">{q.subtext}</span></span>
                        <button onClick={() => deleteQuestionA(q.id)} className="text-red-400 hover:text-red-300 ml-2">
                          <TrashIcon size={16} />
                        </button>
                      </div>
                    ))}
                  </div>
                  
                  <h3 className="text-xl mb-4 text-purple-400">Questions B List ({questionsB.length})</h3>
                  <p className="text-sm text-gray-400 mb-2">Click on a question to upload/change its image.</p>
                   <div className="flex flex-wrap gap-4">
                    {questionsB.map(q => (
                      <div 
                          key={q.id} 
                          className={`relative p-3 rounded border-2 cursor-pointer transition-all ${q.imageBase64 ? 'border-gray-600 bg-gray-800' : 'border-red-500 bg-red-900/20'}`}
                          onClick={() => setEditingQuestionBId(editingQuestionBId === q.id ? null : q.id)}
                      >
                        <div className="flex justify-between items-start mb-2">
                            <span className="text-xs font-bold px-2 py-1 bg-gray-700 rounded">{q.topic}</span>
                            <button onClick={(e) => { e.stopPropagation(); deleteQuestionB(q.id); }} className="text-red-400 hover:text-red-300">
                                <TrashIcon size={16} />
                            </button>
                        </div>
                        <div className="text-lg font-bold text-green-400 mb-1">{q.answer}</div>
                        <div className="text-xs text-gray-400">1: {q.hint1}</div>
                        <div className="text-xs text-gray-400">2: {q.hint2}</div>
                        
                        {/* Status Indicator */}
                        <div className="mt-2 flex items-center gap-1 text-xs">
                            {q.imageBase64 ? <span className="text-green-500">Image OK</span> : <span className="text-red-500 animate-pulse">Missing Image</span>}
                        </div>

                        {/* Upload Overlay */}
                        {editingQuestionBId === q.id && (
                            <div className="absolute inset-0 bg-slate-900/95 flex flex-col items-center justify-center p-2 rounded z-10" onClick={(e) => e.stopPropagation()}>
                                <p className="text-xs mb-2">Upload Image</p>
                                <input type="file" accept="image/*" onChange={(e) => handleImageUploadForId(e, q.id)} className="text-xs w-full text-center" />
                                <button onClick={() => setEditingQuestionBId(null)} className="mt-2 text-xs bg-gray-600 px-2 py-1 rounded">Close</button>
                            </div>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            );
          }
          
          return null;
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>